<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>신비한 타로카드 점술</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Cinzel:wght@400;700&family=Nanum+Myeongjo:wght@400;700&display=swap');

        body {
            font-family: 'Nanum Myeongjo', serif;
            background-color: #0c0c25;
            background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='400' height='400' viewBox='0 0 800 800'%3E%3Cg fill='none' stroke='%23181850' stroke-width='1'%3E%3Cpath d='M769 229L1037 260.9M927 880L731 737 520 660 309 538 40 599 295 764 126.5 879.5 40 599-197 493 102 382-31 229 126.5 79.5-69-63'/%3E%3Cpath d='M-31 229L237 261 390 382 603 493 308.5 537.5 101.5 381.5M370 905L295 764'/%3E%3Cpath d='M520 660L578 842 731 737 840 599 603 493 520 660 295 764 309 538 390 382 539 269 769 229 577.5 41.5 370 105 295 -36 126.5 79.5 237 261 102 382 40 599 -69 737 127 880'/%3E%3Cpath d='M520-140L578.5 42.5 731-63M603 493L539 269 237 261 370 105M902 382L539 269M390 382L102 382'/%3E%3Cpath d='M-222 42L126.5 79.5 370 105 539 269 577.5 41.5 927 80 769 229 902 382 603 493 731 737M295-36L577.5 41.5M578 842L295 764M40-201L127 80M102 382L-261 269'/%3E%3C/g%3E%3Cg fill='%232A2A70'%3E%3Ccircle cx='769' cy='229' r='5'/%3E%3Ccircle cx='539' cy='269' r='5'/%3E%3Ccircle cx='603' cy='493' r='5'/%3E%3Ccircle cx='731' cy='737' r='5'/%3E%3Ccircle cx='520' cy='660' r='5'/%3E%3Ccircle cx='309' cy='538' r='5'/%3E%3Ccircle cx='295' cy='764' r='5'/%3E%3Ccircle cx='40' cy='599' r='5'/%3E%3Ccircle cx='102' cy='382' r='5'/%3E%3Ccircle cx='127' cy='80' r='5'/%3E%3Ccircle cx='370' cy='105' r='5'/%3E%3Ccircle cx='578' cy='42' r='5'/%3E%3Ccircle cx='237' cy='261' r='5'/%3E%3Ccircle cx='390' cy='382' r='5'/%3E%3C/g%3E%3C/svg%3E"),
            radial-gradient(circle, #0c0c25 0%, #040414 100%);
            background-attachment: fixed;
            color: #e1dfff;
            margin: 0;
            padding: 0;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        .container {
            width: 100%;
            max-width: 1200px;
            padding: 20px;
        }

        h1 {
            font-family: 'Cinzel', serif;
            color: #e2c514;
            text-align: center;
            margin: 40px 0;
            font-size: 2.5rem;
            text-shadow: 0 0 10px #e2c51466, 0 0 20px #e2c51433;
            letter-spacing: 2px;
        }

        .settings {
            width: 100%;
            max-width: 600px;
            background: rgba(25, 25, 70, 0.7);
            border-radius: 15px;
            padding: 25px;
            margin: 0 auto 40px;
            backdrop-filter: blur(5px);
            border: 1px solid rgba(100, 100, 255, 0.2);
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.3),
            inset 0 0 20px rgba(100, 100, 255, 0.1);
        }

        .settings h2 {
            font-family: 'Cinzel', serif;
            color: #e2c514;
            margin-top: 0;
            text-align: center;
            text-shadow: 0 0 5px #e2c51433;
        }

        .api-key-input, .question-input {
            width: 100%;
            padding: 12px 0px;
            border: 1px solid rgba(100, 100, 255, 0.3);
            border-radius: 8px;
            background-color: rgba(15, 15, 40, 0.6);
            color: #fff;
            margin-bottom: 15px;
            font-family: 'Nanum Myeongjo', serif;
            font-size: 1rem;
            box-shadow: inset 0 2px 5px rgba(0, 0, 0, 0.2);
            transition: all 0.3s ease;
        }

        .api-key-input:focus, .question-input:focus {
            outline: none;
            border-color: rgba(100, 100, 255, 0.6);
            box-shadow: 0 0 8px rgba(100, 100, 255, 0.4),
            inset 0 2px 5px rgba(0, 0, 0, 0.2);
        }

        .button-container {
            display: flex;
            justify-content: center;
            gap: 15px;
        }

        .button {
            background: linear-gradient(135deg, #8a2be2, #4a1491);
            color: white;
            border: none;
            padding: 12px 25px;
            border-radius: 8px;
            cursor: pointer;
            font-weight: bold;
            font-family: 'Cinzel', serif;
            transition: all 0.3s ease;
            box-shadow: 0 4px 10px rgba(74, 20, 145, 0.3);
        }

        .button:hover {
            background: linear-gradient(135deg, #9d3cf7, #5a1cb1);
            transform: translateY(-2px);
            box-shadow: 0 6px 12px rgba(74, 20, 145, 0.4);
        }

        .button:active {
            transform: translateY(1px);
            box-shadow: 0 2px 5px rgba(74, 20, 145, 0.4);
        }

        .button:disabled {
            background: linear-gradient(135deg, #666, #444);
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }

        .tarot-container {
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            gap: 30px;
            margin: 40px 0;
            perspective: 1000px;
        }

        .card {
            width: 180px;
            height: 300px;
            perspective: 1000px;
            cursor: pointer;
            position: relative;
        }

        .card-inner {
            position: relative;
            width: 100%;
            height: 100%;
            transition: transform 1s cubic-bezier(0.4, 0, 0.2, 1);
            transform-style: preserve-3d;
            box-shadow: 0 0 20px rgba(138, 43, 226, 0.3);
        }

        .card.flipped .card-inner {
            transform: rotateY(180deg);
        }

        .card-front, .card-back {
            position: absolute;
            width: 100%;
            height: 100%;
            backface-visibility: hidden;
            border-radius: 15px;
            overflow: hidden;
        }

        .card-front {
            background: linear-gradient(135deg, #191970, #000033);
            border: 3px solid #4b0082;
            display: flex;
            align-items: center;
            justify-content: center;
            background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='180' height='300' viewBox='0 0 180 300'%3E%3Crect width='100%25' height='100%25' fill='%23191970'/%3E%3Cpath d='M90 30L110 70L140 80L110 110L120 140L90 120L60 140L70 110L40 80L70 70Z' fill='%234b0082' stroke='%238a2be2' stroke-width='1'/%3E%3Ccircle cx='90' cy='200' r='40' fill='none' stroke='%238a2be2' stroke-width='2'/%3E%3Cpath d='M65 200 L115 200 M90 175 L90 225' stroke='%238a2be2' stroke-width='2'/%3E%3Ccircle cx='90' cy='200' r='60' fill='none' stroke='%234a1491' stroke-width='1' stroke-dasharray='8,4'/%3E%3C/svg%3E");
        }

        .card-back {
            background-color: #f5f5f5;
            transform: rotateY(180deg);
            padding: 0;
            display: flex;
            flex-direction: column;
            border: 3px solid #4b0082;
        }

        .card-image {
            width: 100%;
            height: 100%;
            object-fit: contain;
            border-radius: 12px;
        }

        .reading-result {
            width: 100%;
            max-width: 800px;
            background: rgba(25, 25, 70, 0.7);
            border-radius: 15px;
            padding: 30px;
            margin: 20px auto;
            white-space: pre-line;
            backdrop-filter: blur(5px);
            border: 1px solid rgba(100, 100, 255, 0.2);
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.3),
            inset 0 0 20px rgba(100, 100, 255, 0.1);
            line-height: 1.6;
        }

        .reading-header {
            font-family: 'Cinzel', serif;
            color: #e2c514;
            margin-bottom: 20px;
            text-align: center;
            font-size: 1.5rem;
            text-shadow: 0 0 5px #e2c51433;
        }

        .loading {
            text-align: center;
            margin: 20px 0;
            font-style: italic;
            color: #e2c514;
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        .loading::after {
            content: '';
            display: block;
            width: 80px;
            height: 80px;
            margin-top: 15px;
            border-radius: 50%;
            border: 6px solid rgba(138, 43, 226, 0.3);
            border-top-color: #8a2be2;
            animation: spin 1.5s linear infinite;
        }

        @keyframes spin {
            0% {
                transform: rotate(0deg);
            }
            100% {
                transform: rotate(360deg);
            }
        }

        .card-info {
            position: absolute;
            bottom: 0;
            left: 0;
            width: 100%;
            background: rgba(10, 10, 40, 0.8);
            padding: 10px;
            text-align: center;
            font-family: 'Cinzel', serif;
            font-size: 12px;
            color: #e1dfff;
        }

        .reversed {
            color: #ff6b6b;
        }

        .hidden {
            display: none;
        }

        .error {
            color: #ff6b6b;
            font-weight: bold;
            text-align: center;
            margin: 10px 0;
            padding: 10px;
            background: rgba(255, 0, 0, 0.1);
            border-radius: 8px;
            border: 1px solid rgba(255, 107, 107, 0.3);
        }

        .stars {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: -1;
        }

        .star {
            position: absolute;
            background-color: white;
            border-radius: 50%;
            opacity: 0;
            animation: twinkle 5s infinite;
        }

        @keyframes twinkle {
            0% {
                opacity: 0;
            }
            50% {
                opacity: 1;
            }
            100% {
                opacity: 0;
            }
        }

        @media (max-width: 768px) {
            .card {
                width: 140px;
                height: 240px;
            }

            .tarot-container {
                gap: 15px;
            }

            .reading-result {
                padding: 15px;
            }
        }
    </style>
</head>
<body>
<div class="stars" id="stars"></div>
<div class="container">
    <h1>✧ 신비한 타로카드 점술 ✧</h1>

    <div class="settings">
        <h2>✦ 운명의 문 ✦</h2>
        <input type="password" id="apiKey" class="api-key-input" placeholder="OpenAI API 키를 입력하세요">
        <input type="text" id="question" class="question-input" placeholder="당신의 운명에 대한 질문을 입력하세요...">
        <div class="button-container">
            <button id="startReading" class="button">카드 뽑기</button>
            <button id="resetReading" class="button" style="display: none">다시 시작</button>
        </div>
        <div id="error" class="error hidden"></div>
    </div>

    <div id="tarotContainer" class="tarot-container"></div>
    <div id="loading" class="loading hidden">영적인 세계로부터 메시지를 받는 중...</div>

    <div id="readingResult" class="reading-result hidden">
        <div class="reading-header">✧ 타로 해석 ✧</div>
        <div id="readingContent"></div>
    </div>
</div>

<script>
    // 위키미디어 타로카드 이미지 URL과 정보
    const tarotCards = [
        {
            name: "바보",
            number: 0,
            image: "https://upload.wikimedia.org/wikipedia/commons/9/90/RWS_Tarot_00_Fool.jpg",
            description: "새로운 시작, 무지, 자유"
        },
        {
            name: "마법사",
            number: 1,
            image: "https://upload.wikimedia.org/wikipedia/commons/d/de/RWS_Tarot_01_Magician.jpg",
            description: "재능, 기술, 집중"
        },
        {
            name: "여사제",
            number: 2,
            image: "https://upload.wikimedia.org/wikipedia/commons/8/88/RWS_Tarot_02_High_Priestess.jpg",
            description: "지혜, 직관, 깊은 통찰력"
        },
        {
            name: "여제",
            number: 3,
            image: "https://upload.wikimedia.org/wikipedia/commons/d/d2/RWS_Tarot_03_Empress.jpg",
            description: "풍요, 창조성, 양육"
        },
        {
            name: "황제",
            number: 4,
            image: "https://upload.wikimedia.org/wikipedia/commons/c/c3/RWS_Tarot_04_Emperor.jpg",
            description: "권위, 통제, 안정"
        },
        {
            name: "교황",
            number: 5,
            image: "https://upload.wikimedia.org/wikipedia/commons/8/8d/RWS_Tarot_05_Hierophant.jpg",
            description: "신념, 가르침, 지도"
        },
        {
            name: "연인",
            number: 6,
            image: "https://upload.wikimedia.org/wikipedia/commons/d/db/RWS_Tarot_06_Lovers.jpg",
            description: "사랑, 조화, 선택"
        },
        {
            name: "전차",
            number: 7,
            image: "https://upload.wikimedia.org/wikipedia/commons/9/9b/RWS_Tarot_07_Chariot.jpg",
            description: "결정, 성공, 자기 통제"
        },
        {
            name: "힘",
            number: 8,
            image: "https://upload.wikimedia.org/wikipedia/commons/f/f5/RWS_Tarot_08_Strength.jpg",
            description: "용기, 인내, 내면의 강함"
        },
        {
            name: "은둔자",
            number: 9,
            image: "https://upload.wikimedia.org/wikipedia/commons/4/4d/RWS_Tarot_09_Hermit.jpg",
            description: "고독, 명상, 자기 성찰"
        },
        {
            name: "운명의 수레바퀴",
            number: 10,
            image: "https://upload.wikimedia.org/wikipedia/commons/3/3c/RWS_Tarot_10_Wheel_of_Fortune.jpg",
            description: "운명, 기회, 변화"
        },
        {
            name: "정의",
            number: 11,
            image: "https://upload.wikimedia.org/wikipedia/commons/e/e0/RWS_Tarot_11_Justice.jpg",
            description: "균형, 정의, 진실"
        },
        {
            name: "매달린 사람",
            number: 12,
            image: "https://upload.wikimedia.org/wikipedia/commons/2/2b/RWS_Tarot_12_Hanged_Man.jpg",
            description: "포기, 새로운 관점, 희생"
        },
        {
            name: "죽음",
            number: 13,
            image: "https://upload.wikimedia.org/wikipedia/commons/d/d7/RWS_Tarot_13_Death.jpg",
            description: "변화, 종결, 새로운 시작"
        },
        {
            name: "절제",
            number: 14,
            image: "https://upload.wikimedia.org/wikipedia/commons/f/f8/RWS_Tarot_14_Temperance.jpg",
            description: "균형, 조화, 치유"
        },
        {
            name: "악마",
            number: 15,
            image: "https://upload.wikimedia.org/wikipedia/commons/5/55/RWS_Tarot_15_Devil.jpg",
            description: "속박, 유혹, 물질주의"
        },
        {
            name: "탑",
            number: 16,
            image: "https://upload.wikimedia.org/wikipedia/commons/5/53/RWS_Tarot_16_Tower.jpg",
            description: "갑작스러운 변화, 혼란, 계시"
        },
        {
            name: "별",
            number: 17,
            image: "https://upload.wikimedia.org/wikipedia/commons/d/db/RWS_Tarot_17_Star.jpg",
            description: "희망, 영감, 평온"
        },
        {
            name: "달",
            number: 18,
            image: "https://upload.wikimedia.org/wikipedia/commons/7/7f/RWS_Tarot_18_Moon.jpg",
            description: "불확실성, 환상, 직관"
        },
        {
            name: "태양",
            number: 19,
            image: "https://upload.wikimedia.org/wikipedia/commons/1/17/RWS_Tarot_19_Sun.jpg",
            description: "성공, 기쁨, 활력"
        },
        {
            name: "심판",
            number: 20,
            image: "https://upload.wikimedia.org/wikipedia/commons/d/dd/RWS_Tarot_20_Judgement.jpg",
            description: "부활, 재생, 결정"
        },
        {
            name: "세계",
            number: 21,
            image: "https://upload.wikimedia.org/wikipedia/commons/f/ff/RWS_Tarot_21_World.jpg",
            description: "완성, 성취, 통합"
        }
    ];

    const apiKeyInput = document.getElementById('apiKey');
    const questionInput = document.getElementById('question');
    const startReadingBtn = document.getElementById('startReading');
    const resetReadingBtn = document.getElementById('resetReading');
    const tarotContainer = document.getElementById('tarotContainer');
    const readingResult = document.getElementById('readingResult');
    const readingContent = document.getElementById('readingContent');
    const loading = document.getElementById('loading');
    const errorDisplay = document.getElementById('error');
    const starsContainer = document.getElementById('stars');

    let selectedCards = [];
    let isReading = false;

    // 배경에 별 생성
    function createStars() {
        for (let i = 0; i < 100; i++) {
            const star = document.createElement('div');
            star.classList.add('star');

            // 랜덤 위치
            const x = Math.random() * 100;
            const y = Math.random() * 100;

            // 랜덤 크기
            const size = Math.random() * 3;

            // 랜덤 딜레이
            const delay = Math.random() * 5;

            star.style.left = `${x}%`;
            star.style.top = `${y}%`;
            star.style.width = `${size}px`;
            star.style.height = `${size}px`;
            star.style.animationDelay = `${delay}s`;

            starsContainer.appendChild(star);
        }
    }

    // 페이지 로드 시 별 생성
    createStars();

    startReadingBtn.addEventListener('click', startReading);
    resetReadingBtn.addEventListener('click', resetReading);

    function startReading() {
        const apiKey = apiKeyInput.value.trim();
        const question = questionInput.value.trim();

        if (!apiKey) {
            showError('OpenAI API 키를 입력해주세요.');
            return;
        }

        if (!question) {
            showError('질문을 입력해주세요.');
            return;
        }

        hideError();
        isReading = true;
        startReadingBtn.style.display = 'none';
        resetReadingBtn.style.display = 'inline-block';

        // 기존 카드 제거
        tarotContainer.innerHTML = '';
        selectedCards = [];
        readingResult.classList.add('hidden');

        // 카드 섞기
        const shuffledCards = [...tarotCards].sort(() => Math.random() - 0.5);

        // 3장의 카드 선택
        for (let i = 0; i < 3; i++) {
            const cardObj = shuffledCards[i];
            const isReversed = Math.random() > 0.5;
            selectedCards.push({
                ...cardObj,
                isReversed
            });

            createCard(cardObj, i, isReversed);
        }
    }

    function createCard(cardObj, index, isReversed) {
        const card = document.createElement('div');
        card.classList.add('card');
        card.dataset.index = index;

        const cardInner = document.createElement('div');
        cardInner.classList.add('card-inner');

        const cardFront = document.createElement('div');
        cardFront.classList.add('card-front');

        const cardBack = document.createElement('div');
        cardBack.classList.add('card-back');

        // 카드 뒷면에 위키미디어 이미지 추가
        const cardImage = document.createElement('img');
        cardImage.classList.add('card-image');
        cardImage.src = cardObj.image;
        cardImage.alt = cardObj.name;

        // 역방향 적용
        if (isReversed) {
            cardImage.style.transform = 'rotate(180deg)';
        }

        cardBack.appendChild(cardImage);

        // 카드 정보 추가
        const cardInfo = document.createElement('div');
        cardInfo.classList.add('card-info');

        let cardNameText = `${cardObj.number}. ${cardObj.name}`;
        if (isReversed) {
            cardNameText += ' (역방향)';
            cardInfo.classList.add('reversed');
        }

        cardInfo.textContent = cardNameText;
        cardBack.appendChild(cardInfo);

        cardInner.appendChild(cardFront);
        cardInner.appendChild(cardBack);
        card.appendChild(cardInner);

        card.addEventListener('click', () => {
            if (!card.classList.contains('flipped')) {
                flipCard(card);
            }
        });

        tarotContainer.appendChild(card);
    }

    function flipCard(card) {
        card.classList.add('flipped');

        // 모든 카드가 뒤집어졌는지 확인
        const allFlipped = Array.from(document.querySelectorAll('.card')).every(c => c.classList.contains('flipped'));

        if (allFlipped && isReading) {
            // OpenAI API로 해석 요청
            setTimeout(() => {
                getInterpretation();
            }, 1000);
        }
    }

    async function getInterpretation() {
        const apiKey = apiKeyInput.value.trim();
        const question = questionInput.value.trim();

        if (!apiKey || !question) return;

        loading.classList.remove('hidden');

        try {
            const cardsInfo = selectedCards.map((card, i) =>
                `카드 ${i + 1}: ${card.number}. ${card.name}${card.isReversed ? ' (역방향)' : ''} - ${card.description}`
            ).join('\n');

            const prompt = `타로카드 해석:
질문: ${question}

뽑은 카드:
${cardsInfo}

이 세 장의 카드를 기반으로 질문에 대한 타로 해석을 해주세요.
첫 번째 카드는 과거, 두 번째 카드는 현재, 세 번째 카드는 미래를 나타냅니다.
각 카드가 질문과 어떤 관련이 있는지 상세하게 설명해 주세요.
역방향 카드의 경우 일반적으로 그 카드의 에너지가 약화되거나 내면화된 형태로 나타남을 고려해주세요.
신비롭고 영적인 어조로 해석을 제공해주세요.`;

            const response = await fetch('https://api.openai.com/v1/chat/completions', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                    'Authorization': `Bearer ${apiKey}`
                },
                body: JSON.stringify({
                    model: 'gpt-4.5-preview',
                    messages: [
                        {
                            role: 'user',
                            content: prompt
                        }
                    ],
                    temperature: 0.7
                })
            });

            const data = await response.json();

            if (data.error) {
                showError(`API 오류: ${data.error.message}`);
                loading.classList.add('hidden');
                return;
            }

            const interpretation = data.choices[0].message.content;
            readingContent.textContent = interpretation;
            readingResult.classList.remove('hidden');

            // 스크롤 애니메이션
            setTimeout(() => {
                readingResult.scrollIntoView({behavior: 'smooth'});
            }, 500);
        } catch (error) {
            showError(`오류 발생: ${error.message}`);
        } finally {
            loading.classList.add('hidden');
        }
    }

    function resetReading() {
        isReading = false;
        tarotContainer.innerHTML = '';
        readingResult.classList.add('hidden');
        startReadingBtn.style.display = 'inline-block';
        resetReadingBtn.style.display = 'none';
        hideError();
    }

    function showError(message) {
        errorDisplay.textContent = message;
        errorDisplay.classList.remove('hidden');
    }

    function hideError() {
        errorDisplay.classList.add('hidden');
    }
</script>
</body>
</html>
